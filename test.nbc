
dseg segment
distance sword
cropped sword
	
handle word
status word

dlArgs TDrawLine


values word[]
ind  byte 0
nxtindex byte 1

tmpindex byte
tmpvalue byte	
dseg ends

thread main
     SetSensorUltrasonic (IN_1)

     arrinit values, 0, 100
	    
Forever:

     ReadSensorUS (IN_1, distance)

; Store the value in the array of values

     div cropped, distance, 4
     replace values, values, nxtindex, 0
     replace values, values, ind, cropped

     mov ind, nxtindex
     add nxtindex, nxtindex, 1
     brcmp LT, L2, nxtindex, 100
     mov nxtindex, 0
L2:
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

     call drawHisto

     wait 100
     jmp Forever
endt




subroutine drawHisto

  ClearScreen ()
 
  mov tmpindex, 0

  set dlArgs.StartLoc.Y, 0
  set dlArgs.Options, 0x0
L3:
  mov dlArgs.StartLoc.X, tmpindex
  mov dlArgs.EndLoc.X, tmpindex

  index tmpvalue, values, tmpindex
  mov dlArgs.EndLoc.Y, tmpvalue

  syscall DrawLine, dlArgs 

  add tmpindex, tmpindex, 1
  brcmp LT, L3, tmpindex, 100

  return    
ends
